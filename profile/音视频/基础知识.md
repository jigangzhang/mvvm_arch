
## 基础知识

    音视频物理现象
    音、视频数学计算
    音、视频编解码
    音律

#### 声音的物理性质

    声音是波，声音是由物体振动而产生的
    声音是一种压力波，振动引起空气的振动，使空气产生疏密变化，形成疏密相间的纵波，由此产生了声波，直到振动消失
    声波的三要素：
        频率、振幅、波形
        频率代表音阶的高低，振幅代表响度，波形代表音色
        频率越高（过零率），波长就越短
        低频声响波长较长，其可以更容易绕过障碍物，能量衰减就越小，声音传得更远，反之完全相反
        分贝用于描述响度（能量大小的反映）
        同样的音调（频率）和响度（振幅）下，介质不同，产生的波形不同，音色不同
        波的形状决定了其代表声音的音色
    人耳能听到的频率范围是：20Hz~20kHz，等响曲线
    人耳对3~4kHz频率范围内的声音比较敏感，而对较低或较高频率的声音，敏感度就会减弱
    频率范围较广的音乐，其声压以80~90dB最佳，超过90dB将会损害人耳（105dB是人耳极限）
    声压级较低时，听觉频率特性会很不均匀，声压级较高时，听觉的频率特性会变得较为均匀

    传播介质，介质不同，传播速度不同，音色不同，声音无法在真空中传播
    吸音棉、隔音棉
    回声，声音在传播过程中遇到障碍物反弹回来，再次被听到
    若两种声音传到耳朵里的时差小于80毫秒，就无法区分回声
    共鸣，声音传播可以带动另一个物体振动（声音的传播过程也是能量的传播过程）

#### 数字音频

    模拟信号数字化：采样、量化和编码
    采样，就是在时间轴上对信号进行数字化
    采样定理，按比声音最高频率高2倍以上的频率对声音进行采样（AD转换）
    高质量的音频信号的频率范围（人耳能听到）是20Hz~20kHz，所以采样频率一般是44.1kHz（1秒采样44100次）
    量化，是指在幅度轴上对信号进行数字化
    用16bit的二进制信号表示声音的一个采样，16bit所表示的范围是[-32768, 32767]，共有65536个，最终的音频信号在幅度上也分65536层
    编码，按照一定的格式记录采样和量化后的数字数据
    音频裸数据格式是脉冲编码调制数据（PCM）
    描述PCM的几个方面：量化格式（sampleFormat）、采样率（sampleRate）、声道数（channel）
    量化格式就是量化，有16bit、8bit等
    数据比特率，描述声音格式的大小，即1秒时间内的比特数目，用于衡量音频数据单位时间内的容量大小
    CD音质：16bit、44100、2声道
    CD的比特率：44100*2*16*60 / 8 / 1024 = 10.09MB（1分钟的CD音质的数据大小）

    分贝，是指两个相同的物理量之比取以10为底的对数并乘以10（或20）
        N(dB) = 10 * lg(A1 / A0)
        A0是基准量（参考量），A1是被量度量

#### 音频编码

    压缩编码，压缩比
    有损压缩、无损压缩（解压后的数据可以完全复原）
    压缩编码算法：PCM、WAV、AAC、MP3、Ogg等
    压缩编码实际上是压缩掉冗余信号，冗余信号是指不能被人耳感知到的信号，包含人耳听觉范围之外的以及被掩蔽掉的音频信号等
    人耳的掩蔽效应：频域掩蔽效应与时域掩蔽效应

    WAV编码：
        无压缩，是在PCM数据格式的前面加上44字节（描述采样率、声道数、数据格式等）（有多种实现方式）
        音质好
    MP3编码：
        不错的压缩比
        使用LAME编码的中高码率的MP3文件，听感非常接近源WAV文件
        高比特率，音质在128Kbit/s以上表现不错
    AAC编码：
        通过附加的编码技术（PS、SBR等）衍生出LC-AAC、HE-AAC、HE-AAC v2三种主要的编码格式
        LC-AAC（传统的AAC）主要应用于中高码率（>=80Kbit/s）场景
        HE-AAC（AAC+SBR）主要应用于中低码率（<=80Kbit/s）场景的编码
        HE-AAC v2（AAC+SBR+PS）主要应用于低码率（<=48Kbit/s）场景
        低码率下自动启用PS技术，>48Kbit/s则不加PS，相当于HE-AAC
        多用于视频中的音频编码
    Ogg编码：
        高中低码率下均有良好的表现，尤其是中低码率场景下
        128Kbit/s的Ogg比192Kbit/s甚至更高码率的MP3还要出色
        可以用比MP3更小的码率实现比MP3更好的音质
        多用于语音聊天的音频消息场景

#### 图像的物理现象

    视频是由一幅幅图像组成的
    三原色光，红绿蓝（无法被分解），等量的三原色光相加会变成白光
    1280X720的分辨率：水平方向有720个像素点，垂直方向有1280个像素点
    每个像素点都由三个子像素点组成
    显示图像时，将图像的每个像素点的RGB通道对应的屏幕位置上的子像素点绘制到屏幕上
    手机屏幕是自发光的

#### 图像的数值表示

    RGB表示方式：
        浮点表示，取值范围为0.0~1.0（OpenGL ES中对每个像素点这样表示）
        整数表示，取值范围为0~255或00~FF，8个bit表示一个子像素
    RGBA_8888，32个比特表示一个像素
    RGB_565，16个比特表示一个像素
    RGBA_8888 位图（bitmap）在内存中占用大小：1280*720*4=3.516MB
    图像压缩：
        JPEG压缩，是静态图像压缩标准（ISO制定），有损压缩
    YUV表示方式：
        YUV主要应用于优化彩色视频信号的传输，向后兼容黑白电视，相比RGB，只需要占用极少的频宽
        Y 表示明亮度（Luma），也称灰阶值
        U V 表示的是色度（Chroma），描述影像的色彩及饱和度，用于指定像素的颜色
        亮度（Y）是将RGB信号的特定部分叠加到一起
        色度（U、V）定义色调与饱和度，分别用Cr和Cb表示
        （Cr反映RGB信号红色部分与RGB信号亮度值之间的差异，Cb反映的是RGB信号蓝色部分与RGB信号亮度值之间的差异）

        亮度信号Y和色度信号U、V是分离的，如果只有Y没有U、V分量，这样的图像就是黑白灰度图像
        Y、U、V都使用一个字节（8bit）表示，取值范围是0~255
        广播电视系统中不传输很低和很高的数值（为了防止信号变动造成过载，把两边的数值作为保护带）
        Rec.601、BT.709的广播电视标准中，Y的取值范围都是16~235，UV的取值范围都是16~240

        YUV常用的采样格式是4:2:0，指的是对每行扫描线，只有一种色度分量是以2:1的抽样率来存储的
        相邻的扫描行存储着不同的色度分量，即 如果某一行是4:2:0，那么下一行就是4:0:2，再下一行是4:2:0，以此类推
        对于每个色度分量，水平方向和竖直方向的抽样率都是2:1，所以可以说色度的抽样率是4:1

        YUV420P格式的一帧视频帧大小：1280*720*1+1280*720*0.5=1.318MB
        fps为24，电影长度90分钟的大小：1.318MB * 24fps * 90min * 60s = 166.8GB

#### YUV和RGB的转化

    凡是渲染到屏幕上的东西都要转换为RGB的表示形式
    标清电视601标准（BT.601，矩阵计算）：
        Y   0.299       0.587       0.114       R
        U = -0.14713    -0.28886    0.436       G
        V   0.615       -0.51499    -0.10001    B

        R   1   0           1.13983     Y
        G = 1   -0.39465    -0.58060    U
        B   1   2.03211     0           V
    高清电视709标准（BT.709，矩阵计算）：
        Y   0.2126       0.7152       0.0722     R
        U = -0.09991    -0.33609      0.436      G
        V   0.615       -0.55861     -0.05639    B

        R   1   0           1.28033     Y
        G = 1   -0.21482   -0.38059     U
        B   1   2.12798     0           V

#### 视频编码

    视频压缩也是通过去除冗余信息来进行压缩的，空间上的和时间上的冗余信息
    帧间编码技术去除时间上的冗余信息：
        运动补偿，通过先前的局部图像来预测、补偿当前的局部图像，是减少帧序列冗余信息的有效方法
        运动表示，不同区域的图像需要使用不同的运动矢量来描述运动信息
        运动估计，是从视频序列中抽取运动信息的一整套技术
    帧内编码技术去除空间上的冗余信息：
        MPEG（Motion JPEG，ISO制定）算法是适用于动态视频的压缩算法，对单幅图像进行编码，还利用图像序列中的相关原则去除冗余，提高视频的压缩比
        Mpeg1（VCD）、Mpeg2（DVD）、Mpeg4 AVC（流媒体使用）
        ITU-T制定的有H.261、H.262、H.263、H.264、H.265
        H.264采用简洁设计，比Mpeg4更容易推广，现在使用最多的就是H.264标准
        H.264创造了多参考帧、多块类型、整数变换、帧内预测等新的压缩技术，使用了分像素运动矢量（1/4、1/8）和新一代的环路滤波器，使得压缩性能得到大大提高

    编码概念：
        IPB帧：
            I帧：帧内编码帧（intra picture）
                I帧通常是每个GOP的第一个帧，经过适度地压缩，作为随机访问的参考点，可以当成静态图像
                I帧压缩可以得到6:1的压缩比而不会产生可察觉的模糊现象
                I帧压缩可去掉视频的空间冗余信息

            P帧：前向预测编码帧（predictive-frame）
                通过将图像序列中前面已编码帧的时间冗余信息充分去除来压缩传输数据量的编码图像
                可称为预测帧

            B帧：双向预测内插编码帧（bi-directional interpolated prediction frame）
                即考虑源图像序列前面的已编码帧，又顾及源图像序列后面的已编码帧之间的时间冗余信息，来压缩传输数据量的编码图像
                也称为双向预测帧

            I帧可以通过视频解压算法解压成一张单独的完整视频画面（I帧去掉的是视频帧在空间维度上的冗余信息）
            P帧需要参考其前面的一个I帧或者P帧来解码成一张完整的视频画面
            B帧需要参考其前一个I帧或者P帧及其后面的一个P帧来生成一张完整的视频画面
            P帧与B帧去掉的是视频帧在时间维度上的冗余信息

            H264中的IDR帧：
                H264采用多帧预测，所以I帧之后的P帧有可能会参考I帧之前的帧，这使得不能以找到I帧作为参考条件，因为I帧之后的帧还是有可能解析不出来
                IDR帧是一种特殊的I帧，这一帧之后的所有参考帧只会参考到这个IDR帧，而不会再参考前面的帧
                解码器中，收到IDR帧，就会立即清理参考帧缓冲区，并将IDR帧作为被参考的帧

        PTS与DTS：
            DTS主要用于视频的解码，Decoding Time Stamp
            PTS主要用于在解码阶段进行视频的同步和输出，Presentation Time Stamp
            没有B帧的情况下，DTS与PTS的输出顺序是一样的，因为B帧打乱了解码和显示的顺序，所以存在B帧，PTS与DTS就会不同
            PTS决定AVFrame（原始数据）什么时候显式给用户
            DTS表示压缩包（AVPacket）应该在什么时候被解码
            大多数编码标准（H264、HEVC）中，编码顺序和输入顺序并不一致

        GOP：
            两个I帧之间形成的一组图片，就是GOP（Group Of Picture）
            通常在为解码器设置参数的时候，必须要设置gop_size的值，其代表两个I帧之间的帧数目
            gop_size设置得越大，整个画面的质量就会越好
            解码器端必须从接收到的第一个I帧开始才可以正确解码出原始图像，否则会无法正确解码
            I帧可以作为随机访问的帧
            一般来说，I帧的压缩率是7，P是20，B可以达到50
            多使用B帧能节省大量空间，节省出来的空间可以用来等多地保存I帧，这样就能在相同的码率下提供更好的画质

